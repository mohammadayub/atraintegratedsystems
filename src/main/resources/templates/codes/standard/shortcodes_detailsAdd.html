<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head th:replace="~{layout :: page_head}">
    <div th:replace="styles :: persian-datepicker-styles"></div>
    <div th:replace="styles :: select2-styles"></div>
    <div th:replace="styles :: common-css"></div>
    <title>Telecom Short Codes Management System</title>
</head>

<body>
<nav th:replace="~{layout :: page_navbar}"></nav>

<div class="container-fluid mt-4"
     th:classappend="${#locale.language == 'ps' or #locale.language == 'prs'} ? 'label-rtl' : 'label-ltr'">

    <form th:action="@{/codes/standard/shortcodes_detailsAdd/add}"
          th:object="${codeDetailDTO}"
          method="post"
          enctype="multipart/form-data">

        <fieldset style="border:2px solid #DCAF45;padding:15px;border-radius:8px;margin-bottom:20px;">
            <legend style="width:auto;font-size:1.2rem;color:#14438B;padding:0 10px;font-weight:bold;">
                <span th:text="#{telecom_shortcode_details}">Telecom ShortCode Details</span>
            </legend>

            <div class="row g-3">
                <input type="hidden" th:field="*{id}"/>

                <!-- ROW 1 -->
                <div class="col-md-3 form-group">
                    <label th:text="#{select_code}">Select Code</label>
                    <select class="form-control search-select" th:field="*{shortCode}">
                        <option th:each="code : ${codes}"
                                th:value="${code[0]}"
                                th:text="${code[1]}"></option>
                    </select>
                </div>

                <div class="col-md-3 form-group">
                    <label>Short Code Serial</label>
                    <select class="form-control search-select" th:field="*{serialNumberId}">
                        <option value="">--</option>
                        <option th:each="sn : ${serialNumbers}"
                                th:value="${sn.id}"
                                th:text="${sn.serialNumber + ' (' + (sn.status != null ? sn.status : 'Not Assigned') + ')'}">
                        </option>
                    </select>
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{select_status}">Select Status</label>
                    <select class="form-control" th:field="*{codeStatus}">
                        <option value="Active">Active</option>
                        <option value="InActive">Inactive</option>
                    </select>
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{license_applicants}">License Applicant</label>
                    <select class="form-control select2" th:field="*{licenseApplicantId}">
                        <option value="">None</option>
                        <option th:each="la : ${licenseApplicants}"
                                th:value="${la.id}"
                                th:text="${la.companyLicenseName + ' — ' +
                #temporals.format(la.reqDate,'yyyy-MM-dd') +
                ' — Validity: ' + la.validity +
                ' — Admin Fee: ' + la.administrationFeePaymentStatus}">
                        </option>
                    </select>
                </div>

                <!-- ROW 2 -->
                <div class="col-md-3 form-group">
                    <label th:text="#{source_used}">Source Used</label>
                    <input type="text" class="form-control" th:field="*{sourceUsed}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{location}">Location</label>
                    <input type="text" class="form-control" th:field="*{location}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{channel}">Channel</label>
                    <input type="text" class="form-control" th:field="*{chanel}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{services}">Services</label>
                    <textarea class="form-control" th:field="*{services}"></textarea>
                </div>

                <!-- ROW 3 -->
                <div class="col-md-3 form-group">
                    <label th:text="#{select_category_type}">Select Category Type</label>
                    <select class="form-control"
                            th:field="*{categoryType}"
                            id="categoryType"
                            onchange="updateCategoryValues()">
                        <option value="Technical01">Technical01</option>
                        <option value="Business01">Business01</option>
                        <option value="Technical02">Technical02</option>
                        <option value="Business02">Business02</option>
                        <option value="SubShortCodes">SubShortCodes</option>
                    </select>
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{select_category}">Select Category</label>
                    <select class="form-control"
                            th:field="*{category}"
                            id="category"
                            onchange="calculateTotalFees()">
                        <option value="Golden">Golden</option>
                        <option value="Silver">Silver</option>
                        <option value="Normal">Normal</option>
                        <option value="SubShortCodes">SubShortCodes</option>
                    </select>
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{back_long_number}">Back Long Number</label>
                    <input type="text" class="form-control" th:field="*{back_long_number}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{full_name}">Full Name</label>
                    <input type="text" class="form-control" th:field="*{name_of_responsible_person}">
                </div>

                <!-- ROW 4 -->
                <div class="col-md-3 form-group">
                    <label th:text="#{id_card_number}">ID Card Number</label>
                    <input type="text" class="form-control"
                           th:field="*{id_card_number_of_responsible_person}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{mobile_number}">Mobile Number</label>
                    <input type="text" class="form-control"
                           th:field="*{mobile_number_of_responsible_person}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{email_address}">Email Address</label>
                    <input type="text" class="form-control"
                           th:field="*{email_of_responsible_person}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{assigning_date}">Assigning Date</label>
                    <input type="text" class="form-control hijrishamsi"
                           th:field="*{assigning_date}">
                </div>

                <!-- ROW 5 -->
                <div class="col-md-3 form-group">
                    <label th:text="#{expiry_date}">Expiry Date</label>
                    <input type="text" class="form-control hijrishamsi"
                           th:field="*{expiration_date}">
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{application_fees}">Application Fees</label>
                    <input type="number" class="form-control"
                           th:field="*{application_fees}" readonly>
                </div>

                <div class="col-md-3 form-group">
                    <label th:text="#{royality_fees}">Royalty Fees</label>
                    <input type="number" class="form-control"
                           th:field="*{royalty_fees}" readonly>
                </div>

                <input type="hidden" th:field="*{registration_fees}">
                <input type="hidden" id="totalFees">

            </div>

            <!-- BUTTONS -->
            <div class="row mt-4">
                <div class="col-md-4 mx-auto d-flex justify-content-center gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i>
                        <span th:text="#{add_record}">Add Record</span>
                    </button>
                    &nbsp;&nbsp;
                    <button type="reset" class="btn btn-info">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>

        </fieldset>
    </form>
</div>

<!-- SCRIPTS -->
<div th:replace="scripts :: common-scripts"></div>
<div th:replace="scripts :: persian-datepicker-scripts"></div>
<div th:replace="scripts :: select2-scripts"></div>
<div th:replace="scripts :: common-hijrishamsi-date"></div>

<script>
    function updateCategoryValues() {
        var categoryType = document.getElementById('categoryType').value;
        var categorySelect = document.getElementById('category');
        categorySelect.innerHTML = '';

        var categories = [];
        if (categoryType === 'SubShortCodes') {
            categories = ['SubShortCodes'];
        } else {
            categories = ['Golden', 'Silver', 'Normal'];
        }

        categories.forEach(function (c) {
            var opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            categorySelect.appendChild(opt);
        });

        calculateTotalFees();
    }

    function calculateTotalFees() {
        var categoryType = document.getElementById('categoryType').value;
        var category = document.getElementById('category').value;

        var applicationFees = 0;
        var registrationFees = 0;
        var royaltyFees = 0;

        if (categoryType === 'Technical01') {
            applicationFees = 5000;
            royaltyFees = category === 'Golden' ? 50000 :
                          category === 'Silver' ? 40000 : 30000;
        }

        if (categoryType === 'Business01') {
            applicationFees = 5000;
            royaltyFees = category === 'Golden' ? 70000 :
                          category === 'Silver' ? 60000 : 50000;
        }

        if (categoryType === 'Technical02') {
            applicationFees = 3000;
            royaltyFees = category === 'Golden' ? 30000 :
                          category === 'Silver' ? 25000 : 20000;
        }

        if (categoryType === 'Business02') {
            applicationFees = 3000;
            royaltyFees = category === 'Golden' ? 50000 :
                          category === 'Silver' ? 40000 : 30000;
        }

        if (categoryType === 'SubShortCodes') {
            applicationFees = 0;
            royaltyFees = 30000;
        }

        document.getElementById('application_fees').value = applicationFees;
        document.getElementById('royalty_fees').value = royaltyFees;
        document.getElementById('registration_fees').value = registrationFees;
    }

    document.addEventListener('DOMContentLoaded', function () {
        updateCategoryValues();
    });

    $(document).ready(function () {
        $('.search-select').select2();
        $('.hijrishamsi').persianDatepicker({
            format: 'YYYY-MM-DD',
            autoClose: true,
            observer: true,
            calendar: { persian: { locale: 'en' } },
            onShow: function () {
                $('.persian-datepicker-container').appendTo('body');
            }
        });
    });
</script>

</body>
</html>
