<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{codes_layout :: page_head}">
  <title>Royalty Fee Extension</title>
  <div th:replace="styles :: common-css"></div>
  <div th:replace="styles :: commonfieldset"></div>
  <div th:replace="styles :: persian-datepicker-styles"></div>
  <style>
    body {
        background-color: #f5f7fa;
        font-family: "Segoe UI", system-ui, sans-serif;
    }

    /* Page wrapper */
    .page-container {
        max-width: 1100px;
    }

    /* Card */
    .content-card {
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        background: #ffffff;
    }

    /* Header */
    .content-header {
        padding: 16px 20px;
        border-bottom: 1px solid #e5e7eb;
        font-size: 15px;
        font-weight: 600;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Section title */
    .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 18px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    /* Labels */
    .form-label {
        font-size: 13px;
        font-weight: 600;
        color: #4b5563;
    }

    /* Inputs */
    .form-control {
        height: 42px;
        font-size: 14px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
    }

    .form-control:focus {
        border-color: #2563eb;
        box-shadow: none;
    }

    .form-control-readonly {
        background-color: #f3f4f6;
        font-weight: 600;
    }

    /* Input group */
    .input-group-text {
        background-color: #f3f4f6;
        border: 1px solid #d1d5db;
        color: #6b7280;
    }

    [dir="rtl"] .input-group-text {
        border-left: none;
    }

    [dir="ltr"] .input-group-text {
        border-right: none;
    }

    /* Footer */
    .form-footer {
        padding: 20px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Buttons */
    .btn-primary {
        padding: 8px 28px;
        font-size: 14px;
        font-weight: 600;
        border-radius: 6px;
    }

    .btn-secondary {
        padding: 8px 20px;
        font-size: 14px;
        border-radius: 6px;
    }
  </style>
</head>

<body>

<nav th:replace="~{codes_layout :: page_navbar}"></nav>

<div class="container mt-4">

  <div class="content-card">

    <!-- Header -->
    <div class="content-header">
      <i class="bi bi-receipt"></i>
      Application Fee Confirmation
    </div>

    <!-- Body -->
    <div class="p-4">
    <form th:action="@{/finance/code-extension/royalty-fee/save/{id}(id=${codeDetailId})}"
          th:object="${extension}"
          method="post">
      <div class="mb-3">
        <label>Extension Date</label>
        <input type="text"
               class="form-control hijrishamsi"
               id="extensionDate"
               th:field="*{royaltyFeeExtensionDateJalali}">
      </div>

      <div class="mb-3">
        <label>Expiration Date</label>
        <input type="text"
               class="form-control hijrishamsi"
               th:field="*{royaltyFeeExtensionExpirationDateJalali}">
      </div>
      <div class="mb-3">
        <label>Extended Royalty Fee</label>
        <input type="number"
               class="form-control"
               th:field="*{royaltyFeeExtendedFees}"
               id="extendedFees"
               readonly
               required>
      </div>


      <!-- ðŸ”’ SYSTEM VALUES (NOT SHOWN TO USER) -->
      <input type="hidden" th:field="*{extendStatus}">

      <div class="form-footer mt-4">

        <a th:href="@{/codes/finance/royalty-fee/list}"
           class="btn btn-secondary">
          <i class="bi bi-arrow-left"></i>
          Back
        </a>

        <button type="submit" class="btn btn-primary">
          Confirm Payment
        </button>

      </div>

    </form>
    </div>
  </div>
</div>

<div th:replace="scripts :: common-scripts"></div>
<div th:replace="scripts :: persian-datepicker-scripts"></div>
<div th:replace="scripts :: common-hijrishamsi-date"></div>

<script>
  document.addEventListener("DOMContentLoaded", function () {

      const extensionDateInput = document.getElementById("extensionDate");
      const extendedFeesInput = document.getElementById("extendedFees");

      const referenceDate = "1392-02-26";

      function updateExtendedFee() {
          let selectedDate = extensionDateInput.value;

          if (!selectedDate) {
              extendedFeesInput.value = "";
              return;
          }

          // Normalize Persian date format: 1392/02/26 â†’ 1392-02-26
          selectedDate = selectedDate.replaceAll("/", "-");

          // Compare as string (yyyy-mm-dd)
          if (selectedDate > referenceDate) {
              extendedFeesInput.value = 4000;
          } else {
              extendedFeesInput.value = 2000;
          }
      }

      // Persian datepicker usually fires input, not change
      extensionDateInput.addEventListener("input", updateExtendedFee);
      extensionDateInput.addEventListener("change", updateExtendedFee);

      // Run once if value already exists (edit mode)
      updateExtendedFee();
  });
</script>


<div style="height:10vh;"></div>
<footer th:replace="~{codes_layout :: page_footer}"></footer>
</body>
</html>
